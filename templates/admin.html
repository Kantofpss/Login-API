<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <!-- Formulário de Login -->
    <div id="loginSection" class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Login do Administrador</h2>
        <div id="loginError" class="hidden text-red-500 mb-4"></div>
        <input type="text" id="adminUsername" placeholder="Usuário" class="w-full p-3 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        <input type="password" id="adminPassword" placeholder="Senha" class="w-full p-3 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button onclick="adminLogin()" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600">Entrar</button>
    </div>

    <!-- Painel de Administração -->
    <div id="adminPanel" class="hidden bg-white p-8 rounded-lg shadow-lg w-full max-w-4xl">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Painel de Administração</h2>
        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-gray-200">
                    <th class="p-3 border">ID</th>
                    <th class="p-3 border">Nome</th>
                    <th class="p-3 border">Email</th>
                    <th class="p-3 border">Senha (Hasheada)</th>
                    <th class="p-3 border">Ações</th>
                </tr>
            </thead>
            <tbody id="userTable"></tbody>
        </table>
        <button onclick="logout()" class="mt-6 bg-red-500 text-white p-3 rounded-lg hover:bg-red-600">Sair</button>
    </div>

    <script>
        // Função para login do administrador
        async function adminLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');

            try {
                const response = await fetch('https://marin-login-api.onrender.com/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('adminToken', data.access_token);
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('adminPanel').classList.remove('hidden');
                    errorDiv.classList.add('hidden');
                    loadUsers();
                } else {
                    errorDiv.textContent = data.message || 'Erro ao fazer login';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                errorDiv.textContent = 'Erro de conexão com a API';
                errorDiv.classList.remove('hidden');
            }
        }

        // Carregar lista de usuários
        async function loadUsers() {
            try {
                const response = await fetch('https://marin-login-api.onrender.com/users', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const users = await response.json();
                const userTable = document.getElementById('userTable');
                userTable.innerHTML = '';

                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-3 border">${user.id}</td>
                        <td class="p-3 border">${user.name}</td>
                        <td class="p-3 border">${user.email}</td>
                        <td class="p-3 border">${user.password}</td>
                        <td class="p-3 border">
                            <button onclick="deleteUser(${user.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Excluir</button>
                        </td>
                    `;
                    userTable.appendChild(row);
                });
            } catch (error) {
                console.error('Erro ao carregar usuários:', error);
            }
        }

        // Função para excluir usuário
        async function deleteUser(userId) {
            if (!confirm('Tem certeza que deseja excluir este usuário?')) return;

            try {
                const response = await fetch(`https://marin-login-api.onrender.com/admin/users/${userId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });

                if (response.ok) {
                    alert('Usuário excluído com sucesso!');
                    loadUsers();
                } else {
                    alert('Erro ao excluir usuário');
                }
            } catch (error) {
                alert('Erro de conexão com a API');
            }
        }

        // Função de logout
        function logout() {
            localStorage.removeItem('adminToken');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
        }

        // Verificar se já está logado
        if (localStorage.getItem('adminToken')) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            loadUsers();
        }
    </script>
</body>
</html>